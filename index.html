<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoCasino | Decentralized Gambling on Base</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
<script src="contract.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0a0a0f; }
        .gradient-text { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .neon-border { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Header -->
    <nav class="fixed w-full z-50 glass">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center">
                    <span class="text-2xl font-black gradient-text">CryptoCasino</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-400">Base Sepolia</span>
                    <button id="connectBtn" class="bg-purple-600 hover:bg-purple-700 px-6 py-2 rounded-lg font-semibold transition">
                        Connect Wallet
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <section class="pt-32 pb-20 px-4">
        <div class="max-w-7xl mx-auto text-center">
            <h1 class="text-5xl md:text-7xl font-black mb-6">
                The Future of <span class="gradient-text">Decentralized</span> Gambling
            </h1>
            <p class="text-xl text-gray-400 mb-8 max-w-2xl mx-auto">
                Provably fair. Multi-token support. 2% house edge. 
                Built on Base with fully audited smart contracts.
            </p>
            <div class="flex justify-center space-x-4">
                <button class="bg-purple-600 hover:bg-purple-700 px-8 py-4 rounded-xl font-bold text-lg transition neon-border">
                    Start Playing
                </button>
                <button class="glass hover:bg-white/10 px-8 py-4 rounded-xl font-bold text-lg transition">
                    View Contract
                </button>
            </div>
            
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-16 max-w-4xl mx-auto">
                <div class="glass rounded-xl p-6">
                    <div class="text-3xl font-bold gradient-text">2%</div>
                    <div class="text-gray-400">House Edge</div>
                </div>
                <div class="glass rounded-xl p-6">
                    <div class="text-3xl font-bold gradient-text">5%</div>
                    <div class="text-gray-400">Referral Bonus</div>
                </div>
                <div class="glass rounded-xl p-6">
                    <div class="text-3xl font-bold gradient-text">‚àû</div>
                    <div class="text-gray-400">ERC-20 Tokens</div>
                </div>
                <div class="glass rounded-xl p-6">
                    <div class="text-3xl font-bold gradient-text">0.001</div>
                    <div class="text-gray-400">Min Bet (ETH)</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Game Section -->
    <section class="py-20 px-4">
        <div class="max-w-4xl mx-auto">
            <div class="glass rounded-2xl p-8 neon-border">
                <h2 class="text-3xl font-bold mb-6 text-center">Coin Flip</h2>
                <p class="text-gray-400 text-center mb-8">50/50 chance. Double your bet minus 2% house edge.</p>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium mb-2">Select Token</label>
                        <select id="tokenSelect" class="w-full bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white">
                            <option value="eth">ETH (Native)</option>
                            <option value="usdc">USDC (Coming soon)</option>
                            <option value="dai">DAI (Coming soon)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Bet Amount</label>
                        <input type="number" id="betAmount" placeholder="0.01" step="0.001" min="0.001" 
                               class="w-full bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white">
                        <p class="text-sm text-gray-500 mt-1">Min: 0.001 ETH | Max: 10 ETH</p>
                    </div>
                    
                    <div class="flex justify-center space-x-4">
                        <button onclick="placeBet('heads')" class="flex-1 bg-gradient-to-r from-yellow-500 to-yellow-600 hover:from-yellow-600 hover:to-yellow-700 px-6 py-4 rounded-xl font-bold text-lg transition">
                            ü¶Ö Heads
                        </button>
                        <button onclick="placeBet('tails')" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 px-6 py-4 rounded-xl font-bold text-lg transition">
                            ü™ô Tails
                        </button>
                    </div>
                </div>
                
                <div id="gameStatus" class="mt-6 text-center hidden">
                    <p class="text-lg"></p>
                </div>
            </div>
        </div>
    </section>

    <!-- Referral Section -->
    <section class="py-20 px-4 glass">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-3xl font-bold mb-4">Refer & Earn</h2>
            <p class="text-gray-400 mb-8">Get 5% of every bet your referrals lose. Forever.</p>
            
            <div class="glass rounded-xl p-6 max-w-xl mx-auto">
                <div class="flex items-center space-x-4">
                    <input type="text" id="referralLink" readonly 
                           value="https://cryptocasino.base/invite/0x..." 
                           class="flex-1 bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white text-sm">
                    <button onclick="copyReferral()" class="bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg font-semibold transition">
                        Copy
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Contract Info -->
    <section class="py-20 px-4">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold mb-8 text-center">Verified Contract</h2>
            <div class="glass rounded-xl p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <p class="text-sm text-gray-400 mb-1">Contract Address</p>
                        <a href="https://sepolia.basescan.org/address/0x75b8f7aC172C2310a6a6514EB80098709fbc0fBC" 
                           target="_blank" class="text-purple-400 hover:text-purple-300 break-all">
                            0x75b8f7aC172C2310a6a6514EB80098709fbc0fBC
                        </a>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400 mb-1">Network</p>
                        <p>Base Sepolia (Testnet)</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400 mb-1">Deployed</p>
                        <p>Feb 1, 2026</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400 mb-1">Source Code</p>
                        <a href="#" class="text-purple-400 hover:text-purple-300">Verified on BaseScan</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-8 px-4 border-t border-gray-800">
        <div class="max-w-7xl mx-auto text-center text-gray-500">
            <p>Built with ‚ù§Ô∏è by Sisu | 2026</p>
            <p class="text-sm mt-2">Gambling involves risk. Please gamble responsibly.</p>
        </div>
    </footer>

    <script>
        let provider, signer, contract;
        let userAddress = null;

        // Connect wallet
        document.getElementById('connectBtn').addEventListener('click', async () => {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Request account access
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    
                    // Switch to Base Sepolia
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x14a34' }], // 84532 in hex
                        });
                    } catch (switchError) {
                        // Chain not added, add it
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: '0x14a34',
                                    chainName: 'Base Sepolia',
                                    rpcUrls: ['https://sepolia.base.org'],
                                    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                    blockExplorerUrls: ['https://sepolia.basescan.org']
                                }]
                            });
                        }
                    }
                    
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();
                    
                    // Initialize contract
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    
                    document.getElementById('connectBtn').textContent = 
                        userAddress.slice(0, 6) + '...' + userAddress.slice(-4);
                    document.getElementById('connectBtn').classList.add('bg-green-600');
                    document.getElementById('connectBtn').classList.remove('bg-purple-600');
                    
                    // Update referral link
                    document.getElementById('referralLink').value = 
                        `https://cryptocasino.base/invite/${userAddress}`;
                    
                    // Load contract info
                    await loadContractInfo();
                    
                } catch (err) {
                    console.error('Failed to connect:', err);
                    alert('Error connecting: ' + err.message);
                }
            } else {
                alert('Please install MetaMask');
            }
        });

        // Load contract information
        async function loadContractInfo() {
            if (!contract) return;
            
            try {
                const houseEdge = await contract.houseEdgePercent();
                const referral = await contract.referralBonusPercent();
                const minBet = await contract.minBet();
                const maxBet = await contract.maxBet();
                
                console.log('Contract info:', {
                    houseEdge: houseEdge.toString(),
                    referralBonus: referral.toString(),
                    minBet: ethers.utils.formatEther(minBet),
                    maxBet: ethers.utils.formatEther(maxBet)
                });
            } catch (err) {
                console.error('Error loading contract info:', err);
            }
        }

        // Place bet (real contract interaction)
        async function placeBet(side) {
            if (!contract || !userAddress) {
                alert('Please connect your wallet first');
                return;
            }
            
            const amount = document.getElementById('betAmount').value;
            if (!amount || parseFloat(amount) < 0.001) {
                alert('Minimum bet is 0.001 ETH');
                return;
            }
            
            const status = document.getElementById('gameStatus');
            status.classList.remove('hidden');
            status.querySelector('p').textContent = `Placing bet of ${amount} ETH on ${side}...`;
            status.querySelector('p').className = 'text-blue-400 text-lg';
            
            try {
                // Convert choice to number
                const choice = side === 'heads' ? 0 : 1;
                
                // Call placeBet with ETH
                const tx = await contract.placeBet(
                    '0x0000000000000000000000000000000000000000', // Native ETH
                    ethers.utils.parseEther(amount),
                    choice,
                    { value: ethers.utils.parseEther(amount) }
                );
                
                status.querySelector('p').textContent = 'Transaction sent! Waiting for confirmation...';
                
                // Wait for transaction
                const receipt = await tx.wait();
                
                // Check for events
                const betPlacedEvent = receipt.events?.find(e => e.event === 'BetPlaced');
                if (betPlacedEvent) {
                    status.querySelector('p').textContent = `Bet placed! ID: ${betPlacedEvent.args.betId}`;
                    status.querySelector('p').className = 'text-yellow-400 text-lg';
                }
                
            } catch (err) {
                console.error('Bet error:', err);
                status.querySelector('p').textContent = 'Error: ' + (err.reason || err.message);
                status.querySelector('p').className = 'text-red-400 text-lg';
            }
        }

        // Copy referral
        function copyReferral() {
            const input = document.getElementById('referralLink');
            if (!input.value) {
                alert('Connect wallet first to get your referral link');
                return;
            }
            input.select();
            document.execCommand('copy');
            alert('Referral link copied!');
        }
        
        // Listen for account changes
        if (typeof window.ethereum !== 'undefined') {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    // Disconnected
                    userAddress = null;
                    contract = null;
                    document.getElementById('connectBtn').textContent = 'Connect Wallet';
                    document.getElementById('connectBtn').classList.remove('bg-green-600');
                    document.getElementById('connectBtn').classList.add('bg-purple-600');
                } else {
                    // Account changed, reload page
                    window.location.reload();
                }
            });
            
            window.ethereum.on('chainChanged', () => {
                window.location.reload();
            });
        }
    </script>
</body>
</html>
